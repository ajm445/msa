# MSA (Microservices Architecture) 정의서

## 문서 정보

| 항목 | 내용 |
|------|------|
| 문서명 | MSA 아키텍처 정의서 |
| 버전 | 1.0 |
| 작성일 | 2025-01-07 |
| 목적 | MSA 아키텍처 분석 AI 서비스 개발을 위한 기준 문서 |

---

## 1. MSA 개요

### 1.1 정의

**MSA(Microservices Architecture)**는 애플리케이션을 작고 독립적인 서비스들의 집합으로 구성하는 소프트웨어 아키텍처 스타일이다. 각 서비스는 특정 비즈니스 기능을 담당하며, 독립적으로 개발, 배포, 확장이 가능하다.

### 1.2 핵심 원칙

1. **단일 책임 원칙 (Single Responsibility)**: 각 서비스는 하나의 비즈니스 기능만 담당
2. **느슨한 결합 (Loose Coupling)**: 서비스 간 의존성 최소화
3. **높은 응집도 (High Cohesion)**: 관련 기능은 하나의 서비스 내에 집중
4. **독립적 배포 (Independent Deployment)**: 다른 서비스에 영향 없이 개별 배포 가능
5. **분산 데이터 관리 (Decentralized Data Management)**: 서비스별 독립 데이터 저장소

### 1.3 모놀리식 vs MSA 비교

| 구분 | 모놀리식 | MSA |
|------|----------|-----|
| 구조 | 단일 애플리케이션 | 분산된 서비스 집합 |
| 배포 | 전체 재배포 | 개별 서비스 배포 |
| 확장 | 전체 확장 | 서비스별 선택적 확장 |
| 기술 스택 | 단일 스택 | 서비스별 다양한 스택 가능 |
| 장애 영향 | 전체 시스템 | 해당 서비스로 제한 |
| 개발 팀 | 단일/대규모 팀 | 서비스별 소규모 팀 |
| 데이터베이스 | 공유 DB | 서비스별 독립 DB |

---

## 2. MSA 구성 요소

### 2.1 서비스 (Service)

독립적인 비즈니스 기능 단위로, 다음 특성을 갖는다:

- **자율성**: 독립적으로 개발, 테스트, 배포 가능
- **경계 컨텍스트 (Bounded Context)**: 명확한 도메인 경계 보유
- **API 기반 통신**: 표준화된 인터페이스로 외부와 소통
- **데이터 소유권**: 자체 데이터 저장소 보유 및 관리

### 2.2 API Gateway

클라이언트와 마이크로서비스 사이의 진입점 역할:

- 요청 라우팅
- 인증/인가
- 로드 밸런싱
- 요청/응답 변환
- Rate Limiting
- 캐싱

### 2.3 서비스 디스커버리 (Service Discovery)

동적으로 서비스 위치를 찾고 관리하는 메커니즘:

- **서비스 레지스트리**: 서비스 인스턴스 정보 저장소
- **등록 (Registration)**: 서비스 시작 시 자신을 등록
- **발견 (Discovery)**: 다른 서비스 위치 조회
- 대표 도구: Consul, Eureka, etcd

### 2.4 로드 밸런서 (Load Balancer)

트래픽을 여러 서비스 인스턴스에 분산:

- **클라이언트 사이드**: 클라이언트가 직접 분산 (Ribbon)
- **서버 사이드**: 별도 로드 밸런서가 분산 (Nginx, HAProxy)

### 2.5 서킷 브레이커 (Circuit Breaker)

장애 전파 방지 패턴:

| 상태 | 설명 |
|------|------|
| Closed | 정상 상태, 요청 통과 |
| Open | 장애 감지, 요청 즉시 실패 처리 |
| Half-Open | 일부 요청으로 복구 확인 |

### 2.6 메시지 브로커 (Message Broker)

비동기 통신을 위한 메시지 중계 시스템:

- 서비스 간 느슨한 결합 지원
- 이벤트 기반 아키텍처 구현
- 대표 도구: Kafka, RabbitMQ, AWS SQS

### 2.7 컨테이너 및 오케스트레이션

서비스 패키징 및 운영 자동화:

- **컨테이너**: Docker
- **오케스트레이션**: Kubernetes, Docker Swarm

---

## 3. 서비스 간 통신

### 3.1 동기 통신 (Synchronous)

요청-응답 방식으로 즉시 결과를 기다림:

**REST API**
- HTTP 기반 표준 통신
- 리소스 중심 설계
- 상태 비저장 (Stateless)

**gRPC**
- Protocol Buffers 기반 고성능 통신
- 양방향 스트리밍 지원
- 강타입 인터페이스 정의

### 3.2 비동기 통신 (Asynchronous)

메시지 기반으로 결과를 기다리지 않음:

**이벤트 기반 (Event-Driven)**
- 발행-구독 (Pub/Sub) 모델
- 이벤트 소싱 (Event Sourcing)
- 서비스 간 결합도 최소화

**메시지 큐 (Message Queue)**
- 점대점 (Point-to-Point) 통신
- 작업 부하 분산
- 재시도 및 장애 처리

### 3.3 통신 방식 선택 기준

| 상황 | 권장 방식 |
|------|----------|
| 즉시 응답 필요 | 동기 (REST/gRPC) |
| 장시간 처리 작업 | 비동기 (메시지 큐) |
| 여러 서비스에 알림 | 이벤트 기반 (Pub/Sub) |
| 고성능/저지연 요구 | gRPC |
| 외부 시스템 연동 | REST API |

---

## 4. 데이터 관리

### 4.1 Database per Service 패턴

각 서비스가 독립된 데이터베이스를 소유:

- 서비스 자율성 보장
- 기술 다양성 허용 (Polyglot Persistence)
- 데이터 격리로 장애 영향 최소화

### 4.2 데이터 일관성 전략

**Saga 패턴**
분산 트랜잭션을 로컬 트랜잭션의 연속으로 처리:

- Choreography: 이벤트 기반 자율 조정
- Orchestration: 중앙 조정자가 흐름 제어

**CQRS (Command Query Responsibility Segregation)**
명령(쓰기)과 조회(읽기) 모델 분리:

- 읽기/쓰기 최적화 가능
- 복잡한 도메인에 적합
- 이벤트 소싱과 함께 사용

### 4.3 API Composition

여러 서비스의 데이터를 조합하여 응답:

- API Gateway 또는 별도 서비스에서 처리
- 클라이언트 복잡도 감소
- 네트워크 호출 증가 주의

---

## 5. 서비스 분리 기준

### 5.1 도메인 주도 설계 (DDD) 기반

**Bounded Context 식별**
- 비즈니스 도메인 분석
- 유비쿼터스 언어 정의
- 컨텍스트 경계 설정

**서비스 분리 원칙**
1. 하나의 Bounded Context = 하나의 서비스
2. 응집도 높은 기능 그룹화
3. 변경 빈도가 다른 기능 분리

### 5.2 분리 기준 체크리스트

| 기준 | 질문 |
|------|------|
| 비즈니스 기능 | 독립적인 비즈니스 가치를 제공하는가? |
| 데이터 소유권 | 명확한 데이터 경계가 있는가? |
| 변경 빈도 | 다른 기능과 변경 주기가 다른가? |
| 확장 요구 | 독립적인 확장이 필요한가? |
| 팀 구조 | 별도 팀이 소유할 수 있는가? |
| 기술 요구 | 특수한 기술 스택이 필요한가? |

### 5.3 적정 서비스 크기

- **너무 작음**: 통신 오버헤드 증가, 관리 복잡도 상승
- **너무 큼**: 모놀리식의 단점 재현
- **적정 크기**: 2주 내 재작성 가능한 규모 (Two Pizza Team 원칙)

---

## 6. MSA 도입 시 고려사항

### 6.1 장점

- 독립적 배포로 빠른 릴리즈 사이클
- 서비스별 기술 스택 선택 자유
- 장애 격리로 시스템 안정성 향상
- 수평 확장 용이
- 팀 자율성 및 생산성 향상

### 6.2 단점 및 도전 과제

- 분산 시스템 복잡성
- 네트워크 지연 및 장애
- 데이터 일관성 유지 어려움
- 테스트 복잡도 증가
- 운영 및 모니터링 부담

### 6.3 도입 적합성 평가

**MSA가 적합한 경우**
- 대규모 팀 (50명 이상)
- 빈번한 독립 배포 요구
- 서비스별 다른 확장 요구
- 복잡한 도메인

**MSA가 부적합한 경우**
- 소규모 팀/프로젝트
- 단순한 도메인
- 빠른 프로토타이핑 필요
- DevOps 역량 부족

---

## 7. MSA 분석 AI 서비스 설계 가이드

### 7.1 분석 대상 요소

AI 서비스가 분석해야 할 MSA 구성 요소:

| 분석 영역 | 세부 항목 |
|----------|----------|
| 서비스 식별 | 서비스 목록, 경계, 책임 |
| 의존성 분석 | 서비스 간 호출 관계, 의존성 그래프 |
| 통신 패턴 | 동기/비동기, 프로토콜, 메시지 포맷 |
| 데이터 흐름 | 데이터 소유권, 공유 데이터, 일관성 패턴 |
| API 분석 | 엔드포인트, 버전, 계약 |
| 인프라 구성 | 컨테이너, 오케스트레이션, 네트워크 |

### 7.2 기능별 서비스 분리 제안

MSA 분석 AI 서비스의 기능 분리 예시:

```
┌─────────────────────────────────────────────────────────┐
│                    API Gateway                          │
└─────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ▼                   ▼                   ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│  소스 코드     │   │  아키텍처     │   │  리포트       │
│  분석 서비스   │   │  분석 서비스   │   │  생성 서비스   │
└───────────────┘   └───────────────┘   └───────────────┘
        │                   │                   │
        ▼                   ▼                   ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│  코드 파싱    │   │  의존성 그래프 │   │  시각화       │
│  DB           │   │  DB           │   │  DB           │
└───────────────┘   └───────────────┘   └───────────────┘
```

### 7.3 서비스별 책임 정의

**1. 소스 코드 분석 서비스**
- 소스 코드 파싱 및 AST 생성
- 클래스/함수 추출
- API 엔드포인트 식별
- 의존성 라이브러리 분석

**2. 아키텍처 분석 서비스**
- 서비스 경계 식별
- 서비스 간 의존성 매핑
- 통신 패턴 분석
- 데이터 흐름 추적

**3. 리포트 생성 서비스**
- 분석 결과 종합
- 시각화 자료 생성
- 개선 권고사항 도출
- 문서 포맷 변환

**4. 공통 인프라 서비스**
- 사용자 인증/인가
- 파일 저장소 관리
- 알림 서비스
- 로깅 및 모니터링

---

## 8. 참고 자료

### 8.1 핵심 용어 정리

| 용어 | 설명 |
|------|------|
| Bounded Context | 특정 도메인 모델이 적용되는 명확한 경계 |
| Saga | 분산 트랜잭션을 위한 로컬 트랜잭션 시퀀스 패턴 |
| Event Sourcing | 상태 변경을 이벤트로 저장하는 패턴 |
| CQRS | 명령과 조회를 분리하는 패턴 |
| Circuit Breaker | 장애 전파 방지를 위한 차단기 패턴 |
| Service Mesh | 서비스 간 통신을 관리하는 인프라 계층 |
| Sidecar | 메인 서비스와 함께 배포되는 보조 컨테이너 |

### 8.2 주요 기술 스택

| 영역 | 도구/기술 |
|------|----------|
| API Gateway | Kong, AWS API Gateway, Nginx |
| Service Discovery | Consul, Eureka, etcd |
| Message Broker | Kafka, RabbitMQ, AWS SQS |
| Container | Docker |
| Orchestration | Kubernetes |
| Service Mesh | Istio, Linkerd |
| Monitoring | Prometheus, Grafana, Jaeger |
| CI/CD | Jenkins, GitLab CI, ArgoCD |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2025-01-07 | 최초 작성 | - |
